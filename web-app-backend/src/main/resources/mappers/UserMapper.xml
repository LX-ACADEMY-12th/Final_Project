<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.UserMapper">

    <!-- ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ (ë³€ê²½ ì—†ìŒ) -->
    <select id="countByLoginId" resultType="int">
        SELECT COUNT(*)
        FROM "user"
        WHERE "login_id" = #{loginId}
    </select>

    <!-- ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ (ë³€ê²½ ì—†ìŒ) -->
    <select id="countByEmail" resultType="int">
        SELECT COUNT(*)
        FROM "user"
        WHERE email = #{email}updateUserInfo
    </select>

    <!-- íšŒì›ê°€ìž… (ë³€ê²½ ì—†ìŒ) -->
    <insert id="insertUser" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO "user"
            ( "login_id", "password", "name", "email", "phone_number", "created_at" )
        VALUES
            ( #{loginId}, #{password}, #{name}, #{email}, #{phoneNumber}, NOW() )
    </insert>

    <!-- ðŸŸ¢ 'loginId'(String)ë¡œ ì‚¬ìš©ìž ì¡°íšŒ (UserServiceì˜ 'login' ë©”ì„œë“œì—ì„œ ì‚¬ìš©) -->
    <select id="selectUserByLoginId" resultType="com.example.demo.dto.UserDTO">
        SELECT
            user_id AS userId,
            login_id AS loginId,
            password,
            "name",
            email,
            phone_number AS phoneNumber,
            gender,
            region,
            child_grade AS childGrade,
            photo_url AS profileImageUrl
        FROM
            "user"
        WHERE
            login_id = #{loginId}
    </select>

    <!-- ðŸŸ¢ 'userId'(Long)ë¡œ ì‚¬ìš©ìž ì¡°íšŒ (PK ì¡°íšŒ) -->
    <!-- (UserServiceì˜ 'getUserInfoByUserId' ë©”ì„œë“œì—ì„œ ì‚¬ìš©) -->
    <select id="selectUserById" resultType="com.example.demo.dto.UserDTO">
        SELECT
            "user_id" AS userId,
            "login_id" AS loginId,
            "name",
            "email",
            "phone_number" AS phoneNumber,
            "gender",
            "region",
            "child_grade" AS childGrade,
        <!--
          DBì˜ "photo_url" ì»¬ëŸ¼ì„ DTOì˜ "profileImageUrl" í•„ë“œë¡œ ë§¤í•‘í•©ë‹ˆë‹¤.
        -->
            "photo_url" AS profileImageUrl
        FROM
            "user"
        WHERE
            "user_id" = #{userId}
    </select>

    <!-- ðŸŸ¢ 'userId'(Long)ë¡œ íšŒì› íƒˆí‡´ -->
    <!-- (id ë³€ê²½: deleteUserByLoginId -> deleteUserById, WHERE ì¡°ê±´ ë³€ê²½) -->
    <delete id="deleteUserById">
        DELETE FROM "user"
        WHERE "user_id" = #{userId}
    </delete>

    <!-- ðŸŸ¢ 'userId'(Long)ë¡œ ì‚¬ìš©ìž ì •ë³´ ìˆ˜ì • -->
    <!-- (WHERE ì¡°ê±´ ë³€ê²½: login_id -> user_id) -->
    <update id="updateUserInfo">
        UPDATE "user"
        SET
            "name" = #{name},
            "email" = #{email},
            "phone_number" = #{phoneNumber},
            "gender" = #{gender},
            "region" = #{region},
            "child_grade" = #{childGrade},
            "updated_at" = NOW(),
            "photo_url" = #{profileImageUrl}
        WHERE "user_id" = #{userId}
    </update>

</mapper>
